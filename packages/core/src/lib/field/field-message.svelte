<script lang="ts">
	import { classnames } from '@svelte-fui/core/internal';
	import { getFieldContext } from './context';

	const context_field = getFieldContext();
	const open = $derived(context_field.derived.data.open);

	let { class: klass = '', id = undefined, children, ...restProps } = $props();
</script>

{#if open}
	<div
		{id}
		class={classnames(
			'fui-field-validation-message font-regular text-base-200 gap-1',
			context_field.derived.data.state,
			{ 'secondary-text': !!children },
			klass
		)}
		{...restProps}
	>
		{@render children?.({ context: context_field })}
	</div>
{/if}

<style lang="postcss">
	.fui-field-validation-message {
		@apply flex items-center text-left;
	}

	.fui-field-validation-message.secondary-text {
		@apply mt-xxs text-neutral-foreground-3 caption-1;

		&.error {
			@apply text-palette-red-foreground-1;
		}
		&.icon {
			/* Add a gutter for the icon, to allow multiple lines of text to line up to the right of the icon. */
			padding-left: calc(var(--icon-size) + theme(spacing.xs));
		}
	}

	.fui-field-validation-message :global(.fui-field-validation-message-icon) {
		@apply inline-block;
		font-size: var(--icon-size);
		margin-left: calc(-1 * var(--icon-size) - theme(spacing.xs));
		margin-right: theme(spacing.xs);

		line-height: 0;

		vertical-align: -1px;
	}
	.fui-field-validation-message:global(.error) {
		@apply !text-palette-red-foreground-1;
	}
	.fui-field-validation-message:global(.warning) {
		@apply !text-palette-dark-orange-foreground-1;
	}
	.fui-field-validation-message:global(.success) {
		@apply !text-palette-green-foreground-1;
	}
</style>
